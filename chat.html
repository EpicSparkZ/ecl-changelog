<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat</title>
  <link rel="icon" href="/list_icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Your existing styles remain unchanged */
  </style>
</head>
<body>

  <!-- Your existing HTML structure here -->

  <script>
    let bannedWords = [];

    // Fetch banned words and store them in an array
    fetch('https://raw.githubusercontent.com/EpicSparkZ/ecl-changelog/main/data/bannedwords.html')
      .then(res => res.text())
      .then(data => {
        bannedWords = data.split(',').map(word => word.trim().toLowerCase());
      })
      .catch(err => {
        console.error('Failed to load banned words:', err);
      });

    let rainbowInterval;
    let username = "";

    function animateRainbow() {
      let hue = 0;
      rainbowInterval = setInterval(() => {
        document.querySelectorAll('.rainbow').forEach(el => {
          el.style.color = `hsl(${hue}, 100%, 50%)`;
        });
        hue = (hue + 2) % 360;
      }, 50);
    }

    // Check if the message contains any banned words
    function containsBannedWords(message) {
      const words = message.toLowerCase().split(/\s+/);
      return words.some(word => bannedWords.includes(word));
    }

    // Function to send a message
    function sendMessage() {
      const inputUsername = document.getElementById('username').value;
      const message = document.getElementById('message').value;

      // Don't send if either the username or message is empty
      if (!message || !inputUsername) return;

      // If username isn't set yet, save it and lock the input field
      if (!username) {
        username = inputUsername;
        localStorage.setItem('chat_username', username);
        document.getElementById('username').disabled = true; // Disable the input after setting it
      }

      // If message contains a banned word, show an alert and prevent sending
      if (containsBannedWords(message)) {
        alert("Your message contains a banned word and was not sent.");
        return;
      }

      const messageContainer = document.getElementById('message-container');

      const messageElement = document.createElement('div');
      messageElement.classList.add('message');

      const usernameElement = document.createElement('span');
      usernameElement.classList.add('username');
      if (username.toLowerCase() === 'epicsparkz') {
        usernameElement.classList.add('rainbow');
      }
      usernameElement.textContent = username;

      const messageTextElement = document.createElement('span');
      messageTextElement.classList.add('message-text');
      messageTextElement.textContent = ': ' + message;

      messageElement.appendChild(usernameElement);
      messageElement.appendChild(messageTextElement);

      messageContainer.appendChild(messageElement);

      document.getElementById('message').value = '';
      messageContainer.scrollTop = messageContainer.scrollHeight;
    }

    // Listen for the Enter key to send a message
    document.getElementById('message').addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        sendMessage();
      }
    });

    // On page load, check if username is already saved and lock the input if so
    window.addEventListener('DOMContentLoaded', () => {
      animateRainbow();
      const savedUsername = localStorage.getItem('chat_username');
      if (savedUsername) {
        document.getElementById('username').value = savedUsername;
        document.getElementById('username').disabled = true; // Disable input
        username = savedUsername;
      }
    });

  </script>

</body>
</html>
